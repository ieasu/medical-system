<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù†Ø¸Ø§Ù… Ø§Ù„ÙØ­Øµ Ø§Ù„Ø·Ø¨ÙŠ Ø§Ù„ÙˆÙ‚Ø§Ø¦ÙŠ</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 40px; background: #f0f8ff; }
        .container { max-width: 800px; margin: 0 auto; background: white; padding: 20px; border-radius: 10px; box-shadow: 0 0 10px rgba(0,0,0,0.1); }
        .form-group { margin-bottom: 15px; }
        label { display: block; margin-bottom: 5px; font-weight: bold; color: #333; }
        input, select { width: 100%; padding: 10px; border: 2px solid #ddd; border-radius: 5px; font-size: 16px; }
        button { background: #007cba; color: white; padding: 12px 25px; border: none; border-radius: 5px; cursor: pointer; font-size: 16px; margin: 5px; }
        button:hover { background: #005a87; }
        .exam-item { background: #f9f9f9; padding: 15px; margin: 10px 0; border-radius: 5px; border-right: 4px solid #007cba; }
        .success { color: green; font-weight: bold; }
    </style>
</head>
<body>
    <div class="container">
        <h1> Ù†Ø¸Ø§Ù… Ø§Ù„ÙØ­Øµ Ø§Ù„Ø·Ø¨ÙŠ Ø§Ù„ÙˆÙ‚Ø§Ø¦ÙŠ</h1>
       <!--    <p class="success"> Ù…ØªØµÙ„ Ø¨Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø³Ø­Ø§Ø¨ÙŠØ© + Netlify Functions</p>      --> 

        <!-- Ù†Ù…ÙˆØ°Ø¬ Ø¥Ø¶Ø§ÙØ© ÙØ­Øµ Ø¬Ø¯ÙŠØ¯ -->
        <div class="form-section">
            <h2>Ø¥Ø¶Ø§ÙØ© ÙØ­Øµ Ø¬Ø¯ÙŠØ¯</h2>
            <form id="examForm">
                <div class="form-group">
                    <label for="patientName">Ø§Ø³Ù… Ø§Ù„Ù…Ø±ÙŠØ¶:</label>
                    <input type="text" id="patientName" required placeholder="Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ø±ÙŠØ¶">
                </div>
                <div class="form-group">
                    <label for="patientAge">Ø§Ù„Ø¹Ù…Ø±:</label>
                    <input type="number" id="patientAge" required placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„Ø¹Ù…Ø±">
                </div>
                <div class="form-group">
                    <label for="examType">Ù†ÙˆØ¹ Ø§Ù„ÙØ­Øµ:</label>
                    <select id="examType" required>
                        <option value="">Ø§Ø®ØªØ± Ù†ÙˆØ¹ Ø§Ù„ÙØ­Øµ</option>
                        <option value="blood">ÙØ­Øµ Ø§Ù„Ø¯Ù…</option>
                        <option value="xray">Ø£Ø´Ø¹Ø© Ø³ÙŠÙ†ÙŠØ©</option>
                        <option value="urine">ÙØ­Øµ Ø§Ù„Ø¨ÙˆÙ„</option>
                        <option value="pressure">Ù‚ÙŠØ§Ø³ Ø§Ù„Ø¶ØºØ·</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="examResult">Ù†ØªÙŠØ¬Ø© Ø§Ù„ÙØ­Øµ:</label>
                    <input type="text" id="examResult" required placeholder="Ø£Ø¯Ø®Ù„ Ù†ØªÙŠØ¬Ø© Ø§Ù„ÙØ­Øµ">
                </div>
                <button type="submit">â• Ø¥Ø¶Ø§ÙØ© Ø§Ù„ÙØ­Øµ</button>
            </form>
        </div>

        <!-- Ø¹Ø±Ø¶ Ø§Ù„ÙØ­ÙˆØµØ§Øª -->
        <div class="exams-section">
            <h2>Ø§Ù„ÙØ­ÙˆØµØ§Øª Ø§Ù„Ù…Ø¶Ø§ÙØ©</h2>
            <div id="examsList">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...</div>
        </div>

        <!-- Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªØ­ÙƒÙ… -->
        <div class="control-section">
            <h2>Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø³Ø±ÙŠØ¹Ø©</h2>
            <button onclick="addSampleData()">â• Ø¥Ø¶Ø§ÙØ© Ø¨ÙŠØ§Ù†Ø§Øª ØªØ¬Ø±ÙŠØ¨ÙŠØ©</button>
            <button onclick="clearData()">ğŸ—‘ï¸ Ù…Ø³Ø­ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</button>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    
    <script>
        // Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Firebase Ø§Ù„Ø®Ø§ØµØ© Ø¨Ù…Ø´Ø±ÙˆØ¹Ùƒ
        const firebaseConfig = {
            apiKey: "AIzaSyBRZUmAKOOvlNpDkIHIYPPrgLSudZxiooU",
            authDomain: "preventive-health-check.firebaseapp.com",
            projectId: "preventive-health-check",
            storageBucket: "preventive-health-check.firebasestorage.app",
            messagingSenderId: "905531480947",
            appId: "1:905531480947:web:f810504fb795a4bf718306"
        };

        // ØªÙ‡ÙŠØ¦Ø© Firebase
        const app = firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        
        console.log(' ØªÙ… ØªÙˆØµÙŠÙ„ Firebase Ø¨Ù†Ø¬Ø§Ø­!');

        //  Ø¯Ø§Ù„Ø© Ø¬Ø¯ÙŠØ¯Ø© Ù„Ù„Ù…Ø¹Ø§Ù„Ø¬Ø© Ø¹Ø¨Ø± Netlify
        async function addExamWithNetlify(examData) {
            try {
                // Ø­Ø§ÙˆÙ„ÙŠ Ù…Ø¹ Netlify Ø£ÙˆÙ„Ø§Ù‹
                const response = await fetch('/.netlify/functions/process-exam', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify(examData)
                });
                
                const result = await response.json();
                
                if (result.success) {
                    await db.collection('exams').add(result.data);
                    alert(' ØªÙ…Øª Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø³Ø­Ø§Ø¨ÙŠØ© Ø¹Ø¨Ø± Netlify!');
                } else {
                    throw new Error('Netlify failed');
                }
            } catch (error) {
                // Ø¥Ø°Ø§ ÙØ´Ù„ØªØŒ Ø§Ø³ØªØ®Ø¯Ù…ÙŠ Firebase Ù…Ø¨Ø§Ø´Ø±Ø©
                await db.collection('exams').add(examData);
                alert(' ØªÙ… Ø§Ù„Ø­ÙØ¸ Ù…Ø¨Ø§Ø´Ø±Ø© ÙÙŠ Firebase');
            }
        }

        // Ø¥Ø¶Ø§ÙØ© ÙØ­Øµ Ø¬Ø¯ÙŠØ¯ (Ø§Ù„Ù…Ø¹Ø¯Ù„Ø©)
        document.getElementById('examForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const examData = {
                patientName: document.getElementById('patientName').value,
                patientAge: document.getElementById('patientAge').value,
                examType: document.getElementById('examType').value,
                examResult: document.getElementById('examResult').value,
                timestamp: new Date().toLocaleString('ar-SA'),
                status: 'Ù…ÙƒØªÙ…Ù„'
            };
            
            await addExamWithNetlify(examData);
            document.getElementById('examForm').reset();
        });

        // Ø¹Ø±Ø¶ Ø§Ù„ÙØ­ÙˆØµØ§Øª
        db.collection('exams').orderBy('timestamp', 'desc').onSnapshot(snapshot => {
            const examsList = document.getElementById('examsList');
            
            if (snapshot.empty) {
                examsList.innerHTML = 'Ù„Ø§ ØªÙˆØ¬Ø¯ ÙØ­ÙˆØµØ§Øª Ù…Ø¶Ø§ÙØ©.';
                return;
            }
            
            examsList.innerHTML = '';
            snapshot.forEach(doc => {
                const exam = doc.data();
                const examElement = document.createElement('div');
                examElement.className = 'exam-item';
                examElement.innerHTML = `
                    <strong>Ø§Ù„Ù…Ø±ÙŠØ¶:</strong> ${exam.patientName}<br>
                    <strong>Ø§Ù„Ø¹Ù…Ø±:</strong> ${exam.patientAge}<br>
                    <strong>Ù†ÙˆØ¹ Ø§Ù„ÙØ­Øµ:</strong> ${exam.examType}<br>
                    <strong>Ø§Ù„Ù†ØªÙŠØ¬Ø©:</strong> ${exam.examResult}<br>
                    <strong>Ø§Ù„ÙˆÙ‚Øª:</strong> ${exam.timestamp}<br>
                    <strong>Ø§Ù„Ø­Ø§Ù„Ø©:</strong> ${exam.status}
                `;
                examsList.appendChild(examElement);
            });
        });

        // Ø¥Ø¶Ø§ÙØ© Ø¨ÙŠØ§Ù†Ø§Øª ØªØ¬Ø±ÙŠØ¨ÙŠØ©
        async function addSampleData() {
            const sampleExams = [
                { 
                    patientName: "Ø£Ø­Ù…Ø¯ Ù…Ø­Ù…Ø¯", 
                    patientAge: "35", 
                    examType: "blood", 
                    examResult: "Ø·Ø¨ÙŠØ¹ÙŠ", 
                    timestamp: new Date().toLocaleString('ar-SA'),
                    status: "Ø¨ÙŠØ§Ù†Ø§Øª ØªØ¬Ø±ÙŠØ¨ÙŠØ©"
                },
                { 
                    patientName: "ÙØ§Ø·Ù…Ø© Ø®Ø§Ù„Ø¯", 
                    patientAge: "28", 
                    examType: "pressure", 
                    examResult: "120/80", 
                    timestamp: new Date().toLocaleString('ar-SA'),
                    status: "Ø¨ÙŠØ§Ù†Ø§Øª ØªØ¬Ø±ÙŠØ¨ÙŠØ©"
                }
            ];
            
            try {
                for (const exam of sampleExams) {
                    await db.collection('exams').add(exam);
                }
                alert('âœ… ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªØ¬Ø±ÙŠØ¨ÙŠØ©');
            } catch (error) {
                alert('âŒ Ø®Ø·Ø£ ÙÙŠ Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª: ' + error.message);
            }
        }

        // Ù…Ø³Ø­ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
        async function clearData() {
            if (confirm('âš ï¸ Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯Ø© Ù…Ù† Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§ØªØŸ')) {
                try {
                    const snapshot = await db.collection('exams').get();
                    const deletePromises = [];
                    snapshot.forEach(doc => {
                        deletePromises.push(doc.ref.delete());
                    });
                    await Promise.all(deletePromises);
                    alert('âœ… ØªÙ… Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª');
                } catch (error) {
                    alert('âŒ Ø®Ø·Ø£ ÙÙŠ Ù…Ø³Ø­ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª: ' + error.message);
                }
            }
        }
    </script>
</body>
</html>